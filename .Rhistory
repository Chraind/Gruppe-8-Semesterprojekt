# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE) %>%
mutate(
vff_hjemme = grepl("^(VFF|Viborg)", kamp, ignore.case = TRUE),
vff_score = ifelse(vff_hjemme, score_home, score_away),
modstander_score = ifelse(vff_hjemme, score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
filter(vff_hjemme) %>%
# --- Sortér kronologisk ---
arrange(kamp_dato) %>%
# --- Historiske resultater ---
mutate(
vff_vundet_1 = lag(vff_vundet),
vff_vundet_2 = lag(vff_vundet, 1) == "vundet" &
lag(vff_vundet, 2) == "vundet"
) %>%
# --- Befolkningsdata ---
mutate(
år_char = as.character(år),
kvartal = paste0("K", quarter(kamp_dato))
) %>%
filter(!is.na(kamp_dato)) %>%
left_join(viborg_befolkning_komplet, by = c("år_char" = "aar", "kvartal")) %>%
left_join(
viborg_befolkning_komplet %>%
filter(is.na(kvartal)) %>%
select(aar, Indbyggere_Viborg_Kommune) %>%
rename(Indbyggere_aarlig = Indbyggere_Viborg_Kommune),
by = c("år_char" = "aar")
) %>%
mutate(
Indbyggere_Viborg_Kommune = coalesce(Indbyggere_Viborg_Kommune, Indbyggere_aarlig)
) %>%
# Akkumuleret befolkning
arrange(kamp_dato) %>%
mutate(
basis_befolkning = first(Indbyggere_Viborg_Kommune),
akk_indbyggertal = Indbyggere_Viborg_Kommune - basis_befolkning
) %>%
# --- Slutkolonner ---
dplyr::select(
sæson, kamp_dato, ugedag, tid, runde, kamp, tilskuere, dommer,
tv_kanal, helligdag, Indbyggere_Viborg_Kommune,
akk_indbyggertal, tidsgruppe, vff_vundet_1, vff_vundet_2
)
view(vff_kampdata)
vff_kampdata
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
filter(vff_hjemme) %>%
# --- Sortér kronologisk ---
arrange(kamp_dato) %>%
# --- Historiske resultater ---
mutate(
vff_vundet_1 = lag(vff_vundet),
vff_vundet_2 = lag(vff_vundet, 1) == "vundet" &
lag(vff_vundet, 2) == "vundet"
) %>%
# --- Befolkningsdata ---
mutate(
år_char = as.character(år),
kvartal = paste0("K", quarter(kamp_dato))
) %>%
filter(!is.na(kamp_dato)) %>%
left_join(viborg_befolkning_komplet, by = c("år_char" = "aar", "kvartal")) %>%
left_join(
viborg_befolkning_komplet %>%
filter(is.na(kvartal)) %>%
select(aar, Indbyggere_Viborg_Kommune) %>%
rename(Indbyggere_aarlig = Indbyggere_Viborg_Kommune),
by = c("år_char" = "aar")
) %>%
mutate(
Indbyggere_Viborg_Kommune = coalesce(Indbyggere_Viborg_Kommune, Indbyggere_aarlig)
) %>%
# Akkumuleret befolkning
arrange(kamp_dato) %>%
mutate(
basis_befolkning = first(Indbyggere_Viborg_Kommune),
akk_indbyggertal = Indbyggere_Viborg_Kommune - basis_befolkning
) %>%
# --- Slutkolonner ---
dplyr::select(
sæson, kamp_dato, ugedag, tid, runde, kamp, stilling, tilskuere, dommer,
tv_kanal, helligdag, kvartal, Indbyggere_Viborg_Kommune,
akk_indbyggertal, tidsgruppe, vff_vundet_1, vff_vundet_2
)
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
filter(vff_hjemme = TRUE) %>%
# --- Sortér kronologisk ---
arrange(kamp_dato) %>%
# --- Historiske resultater ---
mutate(
vff_vundet_1 = lag(vff_vundet),
vff_vundet_2 = lag(vff_vundet, 1) == "vundet" &
lag(vff_vundet, 2) == "vundet"
) %>%
# --- Befolkningsdata ---
mutate(
år_char = as.character(år),
kvartal = paste0("K", quarter(kamp_dato))
) %>%
filter(!is.na(kamp_dato)) %>%
left_join(viborg_befolkning_komplet, by = c("år_char" = "aar", "kvartal")) %>%
left_join(
viborg_befolkning_komplet %>%
filter(is.na(kvartal)) %>%
select(aar, Indbyggere_Viborg_Kommune) %>%
rename(Indbyggere_aarlig = Indbyggere_Viborg_Kommune),
by = c("år_char" = "aar")
) %>%
mutate(
Indbyggere_Viborg_Kommune = coalesce(Indbyggere_Viborg_Kommune, Indbyggere_aarlig)
) %>%
# Akkumuleret befolkning
arrange(kamp_dato) %>%
mutate(
basis_befolkning = first(Indbyggere_Viborg_Kommune),
akk_indbyggertal = Indbyggere_Viborg_Kommune - basis_befolkning
) %>%
# --- Slutkolonner ---
dplyr::select(
sæson, kamp_dato, ugedag, tid, runde, kamp, stilling, tilskuere, dommer,
tv_kanal, helligdag, kvartal, Indbyggere_Viborg_Kommune,
akk_indbyggertal, tidsgruppe, vff_vundet_1, vff_vundet_2
)
view(vff_kampdata)
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
mutate(
vff_hjemme = grepl("^(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_hjemme == TRUE)
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
mutate(
vff_hjemme = grepl("^(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_hjemme == TRUE)
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
mutate(
vff_hjemme = grepl("^(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_hjemme == TRUE) %>%
# --- Sortér kronologisk ---
arrange(kamp_dato) %>%
# --- Historiske resultater ---
mutate(
vff_vundet_1 = lag(vff_vundet),
vff_vundet_2 = lag(vff_vundet, 1) == "vundet" &
lag(vff_vundet, 2) == "vundet"
) %>%
# --- Befolkningsdata ---
mutate(
år_char = as.character(år),
kvartal = paste0("K", quarter(kamp_dato))
) %>%
filter(!is.na(kamp_dato)) %>%
left_join(viborg_befolkning_komplet, by = c("år_char" = "aar", "kvartal")) %>%
left_join(
viborg_befolkning_komplet %>%
filter(is.na(kvartal)) %>%
select(aar, Indbyggere_Viborg_Kommune) %>%
rename(Indbyggere_aarlig = Indbyggere_Viborg_Kommune),
by = c("år_char" = "aar")
) %>%
mutate(
Indbyggere_Viborg_Kommune = coalesce(Indbyggere_Viborg_Kommune, Indbyggere_aarlig)
) %>%
# Akkumuleret befolkning
arrange(kamp_dato) %>%
mutate(
basis_befolkning = first(Indbyggere_Viborg_Kommune),
akk_indbyggertal = Indbyggere_Viborg_Kommune - basis_befolkning
) %>%
# --- Slutkolonner ---
dplyr::select(
sæson, kamp_dato, ugedag, tid, runde, kamp, stilling, tilskuere, dommer,
tv_kanal, helligdag, kvartal, Indbyggere_Viborg_Kommune,
akk_indbyggertal, tidsgruppe, vff_vundet_1, vff_vundet_2
)
view(vff_kampdata)
view(kampdata_vff_hjemmekampe)
# ---- DATARENSNING ---- #
vff_kampdata <- kombineret_runde_table %>%
# --- Split dato/tid ---
separate(dato, into = c("dato", "tid"), sep = " ", remove = FALSE) %>%
# --- Identificer VFF-kampe ---
mutate(
vff_spiller = grepl("(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_spiller, !is.na(tilskuere)) %>%
# --- Sæson & år ---
mutate(
sæson = paste0(sæson - 1, "/", sæson),
month = as.numeric(str_sub(dato, 4, 5)),
end_year = as.numeric(str_sub(sæson, 6, 9)),
år = ifelse(month >= 7 & month <= 12, end_year - 1, end_year)
) %>%
# --- Dato ---
mutate(kamp_dato = dmy(paste0(dato, "/", år))) %>%
# --- Helligdage ---
mutate(helligdag = kamp_dato %in% as.Date(alle_helligdage$date)) %>%
# --- Tid & tidsgrupper ---
mutate(
tid = na_if(tid, ""),
klokkeslæt = hms::parse_hm(tid),
tidsgruppe = case_when(
klokkeslæt >= hms::parse_hm("12:00") & klokkeslæt < hms::parse_hm("15:30") ~ "tidligt",
klokkeslæt >= hms::parse_hm("15:30") & klokkeslæt < hms::parse_hm("18:30") ~ "midt",
klokkeslæt >= hms::parse_hm("18:30") & klokkeslæt <= hms::parse_hm("23:59") ~ "sent"
)
) %>%
# --- Score & resultat ---
separate(stilling, into = c("score_home", "score_away"), sep = "-", convert = TRUE, remove = FALSE) %>%
mutate(
vff_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_home, score_away),
modstander_score = ifelse(grepl("^(VFF|Viborg)", kamp), score_away, score_home),
vff_vundet = case_when(
vff_score > modstander_score ~ "vundet",
vff_score < modstander_score ~ "tabt",
TRUE ~ "uafgjort"
)
) %>%
# Kun hjemmekampe
mutate(
vff_hjemme = grepl("^(VFF|Viborg)", kamp, ignore.case = TRUE)
) %>%
filter(vff_hjemme == TRUE) %>%
# --- Sortér kronologisk ---
arrange(kamp_dato) %>%
# --- Historiske resultater ---
mutate(
seneste_kamp = lag(vff_vundet),
vff_vundet_2 = lag(vff_vundet, 1) == "vundet" &
lag(vff_vundet, 2) == "vundet"
) %>%
# --- Befolkningsdata ---
mutate(
år_char = as.character(år),
kvartal = paste0("K", quarter(kamp_dato))
) %>%
filter(!is.na(kamp_dato)) %>%
left_join(viborg_befolkning_komplet, by = c("år_char" = "aar", "kvartal")) %>%
left_join(
viborg_befolkning_komplet %>%
filter(is.na(kvartal)) %>%
select(aar, Indbyggere_Viborg_Kommune) %>%
rename(Indbyggere_aarlig = Indbyggere_Viborg_Kommune),
by = c("år_char" = "aar")
) %>%
mutate(
Indbyggere_Viborg_Kommune = coalesce(Indbyggere_Viborg_Kommune, Indbyggere_aarlig)
) %>%
# Akkumuleret befolkning
arrange(kamp_dato) %>%
mutate(
basis_befolkning = first(Indbyggere_Viborg_Kommune),
akk_indbyggertal = Indbyggere_Viborg_Kommune - basis_befolkning
) %>%
# --- Variabelvalg ---
dplyr::select(
sæson, kamp_dato, ugedag, tid, runde, kamp, stilling, tilskuere, dommer,
tv_kanal, helligdag, kvartal, Indbyggere_Viborg_Kommune,
akk_indbyggertal, tidsgruppe, seneste_kamp, vff_vundet_2
)
view(vff_kampdata)
source("C:/Users/eellg/OneDrive/Skrivebord/Dataanalyse/1. Semester/2. samling + eksamen/VFF-case/Gruppe-8-Semesterprojekt/superstatsdata_samlet.R", echo = TRUE)
view(vff_kampdata)
# Gem RDS
saveRDS(vff_kampdata, "data/vff_kampdata.rds")
# Load RDS
vff_kampdata <- readRDS("data/vff_kampdata.rds")
view(vff_kampdata)
